<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>Promptopia 开发笔记（1）——搜索功能的实现与最佳实践</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Notion, Tech, React, Vue"/><meta name="description" content="如何实现搜索功能？"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="Promptopia 开发笔记（1）——搜索功能的实现与最佳实践"/><meta property="og:description" content="如何实现搜索功能？"/><meta property="og:url" content=""/><meta property="og:image" content="https://og-image-craigary.vercel.app/Promptopia%20%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E2%80%94%E2%80%94%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="如何实现搜索功能？"/><meta name="twitter:title" content="Promptopia 开发笔记（1）——搜索功能的实现与最佳实践"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/Promptopia%20%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89%E2%80%94%E2%80%94%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="Musher"/><meta name="next-head-count" content="18"/><link rel="preload" href="/nobelium/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/nobelium/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/nobelium/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/nobelium/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/nobelium/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/nobelium/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/nobelium/_next/static/css/ddbbae80d81b2f88.css" as="style"/><link rel="stylesheet" href="/nobelium/_next/static/css/ddbbae80d81b2f88.css" data-n-g=""/><link rel="preload" href="/nobelium/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/nobelium/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/nobelium/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/nobelium/_next/static/chunks/webpack-017be00eb10a1ae1.js" defer=""></script><script src="/nobelium/_next/static/chunks/main-5b58b7da4815128c.js" defer=""></script><script src="/nobelium/_next/static/chunks/pages/_app-b95f08d6067917bb.js" defer=""></script><script src="/nobelium/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/nobelium/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/nobelium/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/nobelium/_next/static/chunks/pages/%5Bslug%5D-e6f3f3c220b132e2.js" defer=""></script><script src="/nobelium/_next/static/rKeQK-aFhfc5v06FzUaGU/_buildManifest.js" defer=""></script><script src="/nobelium/_next/static/rKeQK-aFhfc5v06FzUaGU/_ssgManifest.js" defer=""></script><script src="/nobelium/_next/static/rKeQK-aFhfc5v06FzUaGU/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="Musher&#x27;s Frontend Coding Blog" href="/nobelium"><div class="h-6"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="14" cy="14" r="14" class="fill-current text-black dark:text-white"></circle><circle cx="14" cy="14" r="14" fill="url(#paint0_radial)"></circle><circle cx="8" cy="8" r="2" fill="white"></circle><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#7FF72A" stop-opacity="1"></stop><stop offset="1" stop-color="#001FCC" stop-opacity="0.1"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">Promptopia 开发笔记（1）——搜索功能的实现与最佳实践</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/nobelium/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-3xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white">🧑‍💻<!-- --> <!-- -->Promptopia 开发笔记（1）——搜索功能的实现与最佳实践</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="#" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="Musher" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Musher" srcSet="https://gravatar.com/avatar/568c024e516219d57a6ef037a7cc3d32?imwidth=32 1x, https://gravatar.com/avatar/568c024e516219d57a6ef037a7cc3d32?imwidth=48 2x" src="https://gravatar.com/avatar/568c024e516219d57a6ef037a7cc3d32?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">Musher</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2024 年 6 月 13 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/nobelium/tag/Next.js"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">Next.js</p></a><a href="/nobelium/tag/React"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">React</p></a><a href="/nobelium/tag/Website"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">Website</p></a></div><div> <img src="https://www.notion.so/images/page-cover/nasa_ibm_type_704.jpg"/> </div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-block-d11cc5a5b9754a3a9d78739e3680b3fa"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Jun 13, 2024</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">Promptopia-dev-note-search-implementation</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-green">Next.js</div><div class="notion-property-multi_select-item notion-item-gray">React</div><div class="notion-property-multi_select-item notion-item-pink">Website</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">如何实现搜索功能？</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-bded7c1e83314bd4a82ea23653ee0852" data-id="bded7c1e83314bd4a82ea23653ee0852"><span><div id="bded7c1e83314bd4a82ea23653ee0852" class="notion-header-anchor"></div><a class="notion-hash-link" href="#bded7c1e83314bd4a82ea23653ee0852" title="前言"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">前言</span></span></h3><div class="notion-text notion-block-9669e9e80a4c4be8bf7c22c4fc5aa64d">为了练手 Nextjs，最近在写一个项目，大概长这样，主要就是做一个大家分享大模型 Prompt 的网站：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-71b7714576574bcc9c526be0a8244783"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F01ff42de-5b53-40d7-a69e-999e3574e640%2F0d0d10f4-59ec-4229-8d63-40a5ae7f4647%2F%25E6%2588%25AA%25E5%25B1%258F2024-06-13_13.50.02.png?table=block&amp;id=71b77145-7657-4bcc-9c52-6be0a8244783&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-d6aa33187b204690aea80b0f2d47ace4">主要技术栈如下：</div><ol start="1" class="notion-list notion-list-numbered notion-block-627c6dac67774fe694ccec6c791b35f9"><li>使用 nextjs 作为整体框架</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-65a20aaee8b94d4e8dc187472701330f"><li>使用<code class="notion-inline-code">next-auth/react</code> 实现谷歌登录</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-29f2755eaf124c1a912ddcb04d23406e"><li>使用 <code class="notion-inline-code">MongoDB</code> 实现后端数据库（不得不感叹实在太方便了，直接就是一个在线服务，可以直接在 github page 这样的静态网站托管服务上部署网站，而且小体量还是免费的，良心企业）</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-69c8905d9e41402c92a4baa59c91b6ab"><li>使用<code class="notion-inline-code">tailwindCSS</code> 写样式（这个项目和我之前写的 <a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://musherm.github.io/Portofolio/">Portfolio</a> 项目同样都用了这个，对于写样式来说实在是太方便了）</li></ol><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-816fca4ebe594e65bbcf7793ef11d373" data-id="816fca4ebe594e65bbcf7793ef11d373"><span><div id="816fca4ebe594e65bbcf7793ef11d373" class="notion-header-anchor"></div><a class="notion-hash-link" href="#816fca4ebe594e65bbcf7793ef11d373" title="搜索功能实现"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">搜索功能实现</span></span></h3><div class="notion-text notion-block-835fbc90a9a84d8a9abd170bee692ad7">结合 <code class="notion-inline-code">MongoDB</code> 来实现增删改还是比较方便的，但在实现搜索功能方面如果只需要搜索 prompt 内容和 tag 内容还是比较简单的，但还要涉及搜索 username ，而 prompt 的 Schema 里只有 userId，需要对两个表进行关联搜索，实现起来还是需要动点脑子的。</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-001a748bb965441e94383b7621087029" data-id="001a748bb965441e94383b7621087029"><span><div id="001a748bb965441e94383b7621087029" class="notion-header-anchor"></div><a class="notion-hash-link" href="#001a748bb965441e94383b7621087029" title="从搜索框开始考虑"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">从搜索框开始考虑</span></span></h4><div class="notion-text notion-block-b68a7980f1854a748d99a9ade364296f">首先我们来看这个输入框：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-2e9e51867b004aa7833cf75307720d7e"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F01ff42de-5b53-40d7-a69e-999e3574e640%2Fbc0dd8a4-ddf2-49c8-aaad-03568004248d%2F%25E6%2588%25AA%25E5%25B1%258F2024-06-13_13.50.02.png?table=block&amp;id=2e9e5186-7b00-4aa7-833c-f75307720d7e&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleSearchChange</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setSearchText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token operator">&lt;</span>form className<span class="token operator">=</span><span class="token string">"relative w-full flex-center"</span> onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>input
    type<span class="token operator">=</span><span class="token string">"text"</span>
    placeholder<span class="token operator">=</span><span class="token string">"Search for a tag or username"</span>
    value<span class="token operator">=</span><span class="token punctuation">{</span>searchText<span class="token punctuation">}</span>
    onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleSearchChange<span class="token punctuation">}</span>
    required
    className<span class="token operator">=</span><span class="token string">"search_input peer"</span>
  <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span></code></pre><div class="notion-text notion-block-acf106c62c134d6988679ca1ba1ed817">我们已经通过 <code class="notion-inline-code">onChange</code> 这个事件把输入框的内容获取到了 <code class="notion-inline-code">searchText</code> 这个变量，因为我想做到的效果是响应式地对输入框的改变进行搜索，也就是你一边输入，一边结果就跟着出来，而不需要你输入回车后才能有相应，所以实际上就是一个依赖于 <code class="notion-inline-code">searchText</code> 的 <code class="notion-inline-code">useEffect</code> 。总结而言，我们对输入框的需求如下：</div><ol start="1" class="notion-list notion-list-numbered notion-block-f327fceddfbb44adb0768e17488179d8"><li>针对输入内容响应式的发送请求；</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-cc1309f11982486d9656daedd6ac0b63"><li>按回车后立刻发送请求</li></ol><div class="notion-text notion-block-2a068c5399f54abfb0aa5e1aa6c80ddf">有了这样的思路，我们很容易写出这样的代码：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>searchText<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 搜索文本不为空，进行搜索</span>
      <span class="token function">fetchSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 搜索文本为空，重新获取所有数据</span>
      <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>searchText<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-8e489a9ce1b44344b570796fc0caa8b9">但是我们不需要进行任何测试就可以轻易得出一个结论：这个体验并不好。因为我们响应式地针对<code class="notion-inline-code">searchText</code> 的每一次改变都发送了查询请求，这并不合理，当我输入 Apple 时，你应该等我输入完成再发送请求，而不是每当我输入一个字母就发送一次请求。</div><div class="notion-text notion-block-1a09b07d3fb141a58fa29d7ef8ba378b">因此我们实际上需要等你完成输入之后等个 1s 钟，确认你没有输入了，再发送请求，这个功能有一个学名——<b>防抖</b>。</div><details class="notion-toggle notion-block-3fe2cc94d08d42b281cb74b6f1c3c687"><summary>关于防抖</summary><div><div class="notion-text notion-block-79a047abd19f48678155cb5456dae6e7">笔者在本科上嵌入式的时候在设计键盘驱动时提到过这个防抖，当时这个功能主要是因为键盘的按键在按下时，输入信号可能会出现（以开关为例）多次通断，如果不在驱动层面进行处理，就会出现“双击”甚至“三击”，对这个现象的处理方式也叫“防抖”，所以实际上<b>防抖就是对短时间内重复输入的过滤</b>。</div></div></details><div class="notion-text notion-block-e5559266ebc1428b9bd226877799669b">那么我们该如何进行防抖处理呢，我们可以想到这样的方式：</div><ol start="1" class="notion-list notion-list-numbered notion-block-8991bef83f174cd48da355749a45df9d"><li>每次输入触发一个定时器，1s 后触发发送请求；</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-c7e908bd3b6347b9a7554d4a06e0d786"><li>在触发请求之前清空上一次的定时器，避免重复触发。</li></ol><div class="notion-text notion-block-da09f49f5e29442f9f000245d77583e7">对于如何清除上一次的定时器，我们可以在<code class="notion-inline-code">useEffect</code> 中的第一个参数传入的回调函数中返回一个用于清空定时器的函数，这个回调函数会在以下情况调用：</div><ol start="1" class="notion-list notion-list-numbered notion-block-86a8f63e958e4e9c89fece1403010856"><li>依赖项变化时；</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-84cdf4e779a6488ca5edc108f803585b"><li>组件卸载时。</li></ol><div class="notion-text notion-block-db10a8ec541f41d5b61ac6dc1b77b455">所以实际上我们只需要把清空定时器的函数返回就行了，不需要特意记录定时器的清空器；但还记得吗，我们还需要在用户输入回车后立即进行发送请求，所以实际上我们还是要记录最新的定时器钩子，方便我们在<code class="notion-inline-code">onSubmit</code> 事件上清除最新的定时器，并立即发送请求，所以具体的实现代码如下：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token comment">// 处理防抖，同时记录最新的 timeoutId，便于清除</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>timeoutId<span class="token punctuation">,</span> setTimeoutId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchSearchPosts</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/prompt/search?searchText='</span> <span class="token operator">+</span> searchText<span class="token punctuation">)</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setPosts</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>searchText<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newTimeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">fetchSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

    <span class="token function">setTimeoutId</span><span class="token punctuation">(</span>newTimeout<span class="token punctuation">)</span>
    <span class="token comment">// 返回一个清除 timeout 的函数，会在下次 useEffect 调用/组件卸载时执行（so sweet）</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>newTimeout<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>searchText<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span>
  <span class="token function">fetchSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-788943d200ff468eb771ba55f8526a3c" data-id="788943d200ff468eb771ba55f8526a3c"><span><div id="788943d200ff468eb771ba55f8526a3c" class="notion-header-anchor"></div><a class="notion-hash-link" href="#788943d200ff468eb771ba55f8526a3c" title="搜索 api 实现"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">搜索 api 实现</span></span></h4><div class="notion-text notion-block-38ef6535c4dc4543a258efb6008ca51c">在实现了搜索框的响应式输入查询、防抖后，我们需要具体实现查询的功能，我们的需求如下：</div><ol start="1" class="notion-list notion-list-numbered notion-block-52acee069a3146999130a17f851a7b75"><li>基于 username 进行查询</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-b9aeaf83134540eb93f48d7837436a82"><li>基于 tag 进行查询</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-506a19d1e7dd4a9b93e285ace381d1e0"><li>基于 prompt 的正文进行查询</li></ol><div class="notion-text notion-block-b51ea5755d084dabb8fce03a813ed18e">数据库表设计如下：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token comment">// Prompt</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model<span class="token punctuation">,</span> models <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mongoose'</span>

<span class="token keyword">const</span> PromptSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">creator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>
    <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'User'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">prompt</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'Prompt is required'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'Tag is required'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Prompt <span class="token operator">=</span> models<span class="token punctuation">.</span>Prompt <span class="token operator">||</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Prompt'</span><span class="token punctuation">,</span> PromptSchema<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Prompt
</code></pre><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token comment">// User</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model<span class="token punctuation">,</span> models <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mongoose'</span>

<span class="token keyword">const</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'Email already exists'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'Email is required'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'Username is required'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">match</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?=.{8,20}$)(?![_.])(?!.*[_.]{2})[a-zA-Z0-9._]+(?&lt;![_.])$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token string">'Username invalid, it should contain 8-20 alphanumeric letters and be unique!'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> User <span class="token operator">=</span> models<span class="token punctuation">.</span>User <span class="token operator">||</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> User
</code></pre><div class="notion-text notion-block-b0e4a4bfafa849edb7b7550b3debba8d">其实后两个都比较简单，主要是基于 username 的查询涉及关联查询，我的实现方式如下：</div><ol start="1" class="notion-list notion-list-numbered notion-block-1c5eb60f64504ed7be30c2ddbddd9680"><li>首先在 User 表中搜索符合条件的 username 对应的 id；</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-bc5aaa6a3a124d2cafa5cacc76571a29"><li>然后在 Prompt 表中使用 or 条件（或者 and 条件，看你想做什么，我这里为了搜索出来结果多一点就用 or 了）加上 id 的判断</li></ol><div class="notion-text notion-block-fe3cf6f7d5e44907bc09726a440b4b2d">具体实现如下：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Prompt <span class="token keyword">from</span> <span class="token string">'@/models/prompt'</span>
<span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">'@/models/user'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connectToDB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/database'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">GET</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">request</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> searchParams <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token keyword">const</span> searchText <span class="token operator">=</span> searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'searchText'</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">connectToDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 拆分关键词</span>
    <span class="token keyword">const</span> keywordArray <span class="token operator">=</span> searchText<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">kw</span> <span class="token operator">=></span> kw<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token comment">// 构建关键词表达式组</span>
    <span class="token keyword">const</span> regexArray <span class="token operator">=</span> keywordArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">kw</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>kw<span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 查询所有满足条件的用户</span>
    <span class="token keyword">const</span> userConditions <span class="token operator">=</span> regexArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">kw</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$regex</span><span class="token operator">:</span> kw <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">$or</span><span class="token operator">:</span> userConditions <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> userIds <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span>

    <span class="token comment">// 查询满足条件的prompts</span>
    <span class="token keyword">const</span> prompts <span class="token operator">=</span> <span class="token keyword">await</span> Prompt<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 用空格区分的关键词更合理的方式是用 and，但我这里先用 or 了，看起来显得多一点</span>
      <span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">prompt</span><span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> regexArray <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> regexArray <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">creator</span><span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> userIds <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'creator'</span><span class="token punctuation">)</span> <span class="token comment">// populate 方法，自动关联 User 表，但是前提需要在表设计时使用</span>
    <span class="token comment">// ref 指向你要关联的表</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>prompts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch prompts'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">500</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="notion-text notion-block-0b7363c0cf544d1c9b6d25c4429fa929">这样我们就实现了搜索功能。</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-6fcc565ad883460685361c28a6c81c21" data-id="6fcc565ad883460685361c28a6c81c21"><span><div id="6fcc565ad883460685361c28a6c81c21" class="notion-header-anchor"></div><a class="notion-hash-link" href="#6fcc565ad883460685361c28a6c81c21" title="后谈——优雅的封装"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">后谈——优雅的封装</span></span></h3><div class="notion-text notion-block-1a87d9a1061c4524a8fe635f5bae4188">我自诩为有代码洁癖（当然了，由于水平有限可能写出来的代码在别人看来也是💩，但至少我自己还要看的过去），之前实现的防抖逻辑全部都放在的 Feed 组件里，这并不优雅，Feed 组件应该只需要考虑这个组件内部的逻辑，但搜索这个功能其实跟 Feed 信息流没什么关系，只是这里有一个搜索框，而我们又需要调用搜索功能而已，所以我们不该把无关的功能全都堆在一个组件内部，这既不利于我们对搜索功能进行复用，也不利于别人理解我们的代码。所以实际上我们需要对这个搜索功能进行封装</div><div class="notion-text notion-block-21acc1f956a841cd8e3f9f3fe564cc2c">在前端开发中，这种用于处理与组件状态、生命周期相关的逻辑，我们一般称其为 Hook，并使用 <code class="notion-inline-code">use</code> 开头的函数对其进行封装，并组织在 src/hooks 这一文件夹中，所以我封装了以下 hook：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> useSearchPosts <span class="token operator">=</span> <span class="token punctuation">(</span>initialSearchText <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>searchText<span class="token punctuation">,</span> setSearchText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialSearchText<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>posts<span class="token punctuation">,</span> setPosts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>timeoutId<span class="token punctuation">,</span> setTimeoutId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取所有 prompt</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fetchPosts</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/prompt'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setPosts</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据搜索关键词获取 prompt</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fetchSearchPosts</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/prompt/search?searchText='</span> <span class="token operator">+</span> searchText<span class="token punctuation">)</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setPosts</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 防抖</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>searchText<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newTimeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">fetchSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

      <span class="token function">setTimeoutId</span><span class="token punctuation">(</span>newTimeout<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>newTimeout<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>searchText<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleSearchChange</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setSearchText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span>
    <span class="token function">fetchSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    searchText<span class="token punctuation">,</span>
    posts<span class="token punctuation">,</span>
    fetchPosts<span class="token punctuation">,</span>
    handleSearchChange<span class="token punctuation">,</span>
    handleSubmit
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useSearchPosts</code></pre><div class="notion-text notion-block-af9b181cad5846adba1e3d0c2c8ed46a">并在 Feed 组件内调用，使用方式如下：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token string">'use client'</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useContext<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> PromptCard <span class="token keyword">from</span> <span class="token string">'./PromptCard'</span>
<span class="token keyword">import</span> basePathContext <span class="token keyword">from</span> <span class="token string">'@/context/basePathContext'</span>
<span class="token keyword">import</span> useSearchPosts <span class="token keyword">from</span> <span class="token string">'@/hooks/useSearchPosts'</span>

<span class="token keyword">const</span> <span class="token function-variable function">PromptCardList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token punctuation">,</span> handleTagClick <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"mt-16 prompt_layout"</span><span class="token operator">></span>
      <span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>PromptCard key<span class="token operator">=</span><span class="token punctuation">{</span>post<span class="token punctuation">.</span>id<span class="token punctuation">}</span> post<span class="token operator">=</span><span class="token punctuation">{</span>post<span class="token punctuation">}</span> handleTagClick<span class="token operator">=</span><span class="token punctuation">{</span>handleTagClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">Feed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> basePath <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> searchText<span class="token punctuation">,</span> posts<span class="token punctuation">,</span> fetchPosts<span class="token punctuation">,</span> handleSearchChange<span class="token punctuation">,</span> handleSubmit <span class="token punctuation">}</span> <span class="token operator">=</span>
    <span class="token function">useSearchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>basePathContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>basePath<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>section className<span class="token operator">=</span><span class="token string">"feed"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>form className<span class="token operator">=</span><span class="token string">"relative w-full flex-center"</span> onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>input
            type<span class="token operator">=</span><span class="token string">"text"</span>
            placeholder<span class="token operator">=</span><span class="token string">"Search for a tag or username"</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span>searchText<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleSearchChange<span class="token punctuation">}</span>
            required
            className<span class="token operator">=</span><span class="token string">"search_input peer"</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>

        <span class="token operator">&lt;</span>PromptCardList data<span class="token operator">=</span><span class="token punctuation">{</span>posts<span class="token punctuation">}</span> handleTagClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>basePathContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Feed</code></pre><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-2e4810cac5d94127a379440fb8dcc1a1" data-id="2e4810cac5d94127a379440fb8dcc1a1"><span><div id="2e4810cac5d94127a379440fb8dcc1a1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#2e4810cac5d94127a379440fb8dcc1a1" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h3><div class="notion-text notion-block-1621950683f745efbe703e820c13ca71">跟着视频敲代码很简单，很多时候 youtuber 不解释他为什么这么写，你也不会去思考这个功能为什么要分这么多个文件？分这么多层？但一旦从头开始思考一个功能如何实现，需要思考的问题就很多了，比如我们实际上只是实现了一个非常简单的搜索功能，但本身涉及的有：</div><ol start="1" class="notion-list notion-list-numbered notion-block-26c635b0b50447d2aed45512e320d4d6"><li>防抖功能的实现</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-3997e5a64f494bf7afa187c5ab21fccc"><li>搜索 api 的实现</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-5e3fceaf6f92458fb567e2f735700f24"><li>自定义 Hook 的封装与调用</li></ol><hr class="notion-hr notion-block-88dc04912d374e47a42334e71d5948ec"/><div class="notion-text notion-block-9c7b0abb9e7944ad9e6c257412b48220">Wish you have a good day! 😇</div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-3xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->Musher<!-- --> <!-- -->2019 - 2024</p><p>powered by <a href="https://github.com/craigary/nobelium"><u>nobelium</u></a></p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","date":{"start_date":"2024-06-13"},"type":["Post"],"slug":"Promptopia-dev-note-search-implementation","tags":["Next.js","React","Website"],"summary":"如何实现搜索功能？","title":"Promptopia 开发笔记（1）——搜索功能的实现与最佳实践","status":["Published"],"createdTime":"Thu Jun 13 2024 05:48:11 GMT+0000 (Coordinated Universal Time)","fullWidth":false,"pageIcon":"🧑‍💻","pageCover":"/images/page-cover/nasa_ibm_type_704.jpg"},"blockMap":{"block":{"d11cc5a5-b975-4a3a-9d78-739e3680b3fa":{"value":{"id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","version":522,"type":"page","properties":{"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2024-06-13"}]]]],"`gQ~":[["Post"]],"d]hq":[["Promptopia-dev-note-search-implementation"]],"sD^m":[["Next.js,React,Website"]],"wz|S":[["如何实现搜索功能？"]],"title":[["Promptopia 开发笔记（1）——搜索功能的实现与最佳实践"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["bded7c1e-8331-4bd4-a82e-a23653ee0852","9669e9e8-0a4c-4be8-bf7c-22c4fc5aa64d","71b77145-7657-4bcc-9c52-6be0a8244783","d6aa3318-7b20-4690-aea8-0b0f2d47ace4","627c6dac-6777-4fe6-94cc-ec6c791b35f9","65a20aae-e8b9-4d4e-8dc1-87472701330f","29f2755e-af12-4c1a-912d-dcb04d23406e","69c8905d-9e41-402c-92a4-baa59c91b6ab","816fca4e-be59-4e65-bbcf-7793ef11d373","835fbc90-a9a8-4d8a-9abd-170bee692ad7","001a748b-b965-441e-9438-3b7621087029","b68a7980-f185-4a74-8d99-a9ade364296f","2e9e5186-7b00-4aa7-833c-f75307720d7e","1f24057e-4606-4f54-9332-22841ba69416","acf106c6-2c13-4d69-8867-9ca1ba1ed817","f327fced-dfbb-44ad-b076-8e17488179d8","cc1309f1-1982-486d-9656-daedd6ac0b63","2a068c53-99f5-4abf-b0aa-5e1aa6c80ddf","514bf167-c858-4930-8be6-07fb7a1cb474","8e489a9c-e1b4-4344-b570-796fc0caa8b9","1a09b07d-3fb1-41a5-8fa2-9d7ef8ba378b","3fe2cc94-d08d-42b2-81cb-74b6f1c3c687","e5559266-ebc1-428b-9bd2-26877799669b","8991bef8-3f17-4cd4-8da3-55749a45df9d","c7e908bd-3b63-47b9-a755-4d4a06e0d786","da09f49f-5e29-442f-9f00-0245d77583e7","86a8f63e-958e-4e9c-89fe-ce1403010856","84cdf4e7-79a6-488c-a5ed-c108f803585b","db10a8ec-541f-41d5-b61a-c6dc1b77b455","670a2e9a-0efb-4a2c-a55b-462831b6c4a3","788943d2-00ff-468e-b771-ba55f8526a3c","38ef6535-c4dc-4543-a258-efb6008ca51c","52acee06-9a31-4699-9130-a17f851a7b75","b9aeaf83-1345-40eb-93f4-8d7837436a82","506a19d1-e7dd-4a9b-93e2-85ace381d1e0","b51ea575-5d08-4dab-b8fc-e03a813ed18e","907c89fc-3098-4629-8cb7-9942d90b0bcc","8d1fdbcd-e118-44ad-a983-48fa9500bafa","b0e4a4bf-afa8-49ed-b7b7-550b3debba8d","1c5eb60f-6450-4ed7-be30-c2ddbddd9680","bc5aaa6a-3a12-4d2c-afa5-cacc76571a29","fe3cf6f7-d5e4-4907-bc09-726a440b4b2d","d49d3745-c0db-46d6-8155-31481ace0592","0b7363c0-cf54-4d1c-9b6d-25c4429fa929","6fcc565a-d883-4606-8536-1c28a6c81c21","1a87d9a1-061c-4524-a8fe-635f5bae4188","21acc1f9-56a8-41cd-8e3f-9f3fe564cc2c","070d6806-2edf-49e4-b8a2-f99aad2b0a74","af9b181c-ad58-46ad-ba1e-3d0c2c8ed46a","b4aad56a-32fc-4868-9b75-7d4777a974a6","2e4810ca-c5d9-4127-a379-440fb8dcc1a1","16219506-83f7-45ef-be70-3e820c13ca71","26c635b0-b504-47d2-aed4-5512e320d4d6","3997e5a6-4f49-4bf7-afa1-87c5ab21fccc","5e3fceaf-6f92-458f-b567-e2f735700f24","88dc0491-2d37-4e47-a423-34e71d5948ec","9c7b0abb-9e79-44ad-9e6c-257412b48220"],"format":{"page_icon":"🧑‍💻","page_cover":"/images/page-cover/nasa_ibm_type_704.jpg","page_cover_position":0.8},"created_time":1718257691879,"last_edited_time":1718292321258,"parent_id":"4126d965-c550-46af-bc34-c038f0103084","parent_table":"collection","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"0eb813c6-179c-43e0-8c12-27cc22341e33":{"value":{"id":"0eb813c6-179c-43e0-8c12-27cc22341e33","version":37,"type":"collection_view_page","view_ids":["1df80a31-46e8-4fcd-b9a3-dde8ded944c9"],"collection_id":"4126d965-c550-46af-bc34-c038f0103084","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"4126d965-c550-46af-bc34-c038f0103084","table":"collection","spaceId":"01ff42de-5b53-40d7-a69e-999e3574e640"},"copied_from_pointer":{"id":"ee99f65a-23ab-44f8-ac80-270122ee8138","table":"block","spaceId":"b3580129-1025-4b78-9e73-0a6f39f464ab"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"4e783237-cc83-440e-9604-bac369009c55"},{"role":"reader","type":"public_permission","added_timestamp":1716963272589}],"created_time":1716962484995,"last_edited_time":1718352944249,"parent_id":"01ff42de-5b53-40d7-a69e-999e3574e640","parent_table":"space","alive":true,"copied_from":"ee99f65a-23ab-44f8-ac80-270122ee8138","created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"bded7c1e-8331-4bd4-a82e-a23653ee0852":{"value":{"id":"bded7c1e-8331-4bd4-a82e-a23653ee0852","version":23,"type":"sub_header","properties":{"title":[["前言"]]},"created_time":1718257838147,"last_edited_time":1718257843559,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"9669e9e8-0a4c-4be8-bf7c-22c4fc5aa64d":{"value":{"id":"9669e9e8-0a4c-4be8-bf7c-22c4fc5aa64d","version":270,"type":"text","properties":{"title":[["为了练手 Nextjs，最近在写一个项目，大概长这样，主要就是做一个大家分享大模型 Prompt 的网站："]]},"created_time":1718257758534,"last_edited_time":1718292321258,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"71b77145-7657-4bcc-9c52-6be0a8244783":{"value":{"id":"71b77145-7657-4bcc-9c52-6be0a8244783","version":13,"type":"image","properties":{"size":[["5501.2KB"]],"title":[["截屏2024-06-13 13.50.02.png"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/01ff42de-5b53-40d7-a69e-999e3574e640/0d0d10f4-59ec-4229-8d63-40a5ae7f4647/%E6%88%AA%E5%B1%8F2024-06-13_13.50.02.png"]]},"format":{"block_width":635,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/01ff42de-5b53-40d7-a69e-999e3574e640/0d0d10f4-59ec-4229-8d63-40a5ae7f4647/%E6%88%AA%E5%B1%8F2024-06-13_13.50.02.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.5625,"block_preserve_scale":true},"created_time":1718257821329,"last_edited_time":1718257826746,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"file_ids":["0d0d10f4-59ec-4229-8d63-40a5ae7f4647"],"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"d6aa3318-7b20-4690-aea8-0b0f2d47ace4":{"value":{"id":"d6aa3318-7b20-4690-aea8-0b0f2d47ace4","version":42,"type":"text","properties":{"title":[["主要技术栈如下："]]},"created_time":1718257812271,"last_edited_time":1718257854752,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"627c6dac-6777-4fe6-94cc-ec6c791b35f9":{"value":{"id":"627c6dac-6777-4fe6-94cc-ec6c791b35f9","version":86,"type":"numbered_list","properties":{"title":[["使用 nextjs 作为整体框架"]]},"created_time":1718257909641,"last_edited_time":1718257929930,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"65a20aae-e8b9-4d4e-8dc1-87472701330f":{"value":{"id":"65a20aae-e8b9-4d4e-8dc1-87472701330f","version":123,"type":"numbered_list","properties":{"title":[["使用"],["next-auth/react",[["c"]]],[" 实现谷歌登录"]]},"created_time":1718257854924,"last_edited_time":1718257909125,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"29f2755e-af12-4c1a-912d-dcb04d23406e":{"value":{"id":"29f2755e-af12-4c1a-912d-dcb04d23406e","version":518,"type":"numbered_list","properties":{"title":[["使用 "],["MongoDB",[["c"]]],[" 实现后端数据库（不得不感叹实在太方便了，直接就是一个在线服务，可以直接在 github page 这样的静态网站托管服务上部署网站，而且小体量还是免费的，良心企业）"]]},"created_time":1718257938048,"last_edited_time":1718258046718,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"69c8905d-9e41-402c-92a4-baa59c91b6ab":{"value":{"id":"69c8905d-9e41-402c-92a4-baa59c91b6ab","version":461,"type":"numbered_list","properties":{"title":[["使用"],["tailwindCSS",[["c"]]],[" 写样式（这个项目和我之前写的 "],["Portfolio",[["a","https://musherm.github.io/Portofolio/"]]],[" 项目同样都用了这个，对于写样式来说实在是太方便了）"]]},"created_time":1718258004828,"last_edited_time":1718258175368,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"816fca4e-be59-4e65-bbcf-7793ef11d373":{"value":{"id":"816fca4e-be59-4e65-bbcf-7793ef11d373","version":47,"type":"sub_header","properties":{"title":[["搜索功能实现"]]},"created_time":1718258226121,"last_edited_time":1718258233197,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"835fbc90-a9a8-4d8a-9abd-170bee692ad7":{"value":{"id":"835fbc90-a9a8-4d8a-9abd-170bee692ad7","version":1020,"type":"text","properties":{"title":[["结合 "],["MongoDB",[["c"]]],[" 来实现增删改还是比较方便的，但在实现搜索功能方面如果只需要搜索 prompt 内容和 tag 内容还是比较简单的，但还要涉及搜索 username ，而 prompt 的 Schema 里只有 userId，需要对两个表进行关联搜索，实现起来还是需要动点脑子的。"]]},"created_time":1718258233377,"last_edited_time":1718259349141,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"001a748b-b965-441e-9438-3b7621087029":{"value":{"id":"001a748b-b965-441e-9438-3b7621087029","version":73,"type":"sub_sub_header","properties":{"title":[["从搜索框开始考虑"]]},"created_time":1718259765458,"last_edited_time":1718259776521,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"b68a7980-f185-4a74-8d99-a9ade364296f":{"value":{"id":"b68a7980-f185-4a74-8d99-a9ade364296f","version":64,"type":"text","properties":{"title":[["首先我们来看这个输入框："]]},"created_time":1718259349350,"last_edited_time":1718259354046,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"2e9e5186-7b00-4aa7-833c-f75307720d7e":{"value":{"id":"2e9e5186-7b00-4aa7-833c-f75307720d7e","version":11,"type":"image","properties":{"size":[["730.1KB"]],"title":[["截屏2024-06-13 13.50.02.png"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/01ff42de-5b53-40d7-a69e-999e3574e640/bc0dd8a4-ddf2-49c8-aaad-03568004248d/%E6%88%AA%E5%B1%8F2024-06-13_13.50.02.png"]]},"format":{"block_width":2443,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/01ff42de-5b53-40d7-a69e-999e3574e640/bc0dd8a4-ddf2-49c8-aaad-03568004248d/%E6%88%AA%E5%B1%8F2024-06-13_13.50.02.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.29267294310274256,"block_preserve_scale":true},"created_time":1718259820241,"last_edited_time":1718259823892,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"file_ids":["bc0dd8a4-ddf2-49c8-aaad-03568004248d"],"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"1f24057e-4606-4f54-9332-22841ba69416":{"value":{"id":"1f24057e-4606-4f54-9332-22841ba69416","version":79,"type":"code","properties":{"title":[["const handleSearchChange = e =\u003e {\n    setSearchText(e.target.value)\n  }\n\n\u003cform className=\"relative w-full flex-center\" onSubmit={handleSubmit}\u003e\n  \u003cinput\n    type=\"text\"\n    placeholder=\"Search for a tag or username\"\n    value={searchText}\n    onChange={handleSearchChange}\n    required\n    className=\"search_input peer\"\n  /\u003e\n\u003c/form\u003e"]],"language":[["JavaScript"]]},"created_time":1718259354195,"last_edited_time":1718259388692,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"acf106c6-2c13-4d69-8867-9ca1ba1ed817":{"value":{"id":"acf106c6-2c13-4d69-8867-9ca1ba1ed817","version":1119,"type":"text","properties":{"title":[["我们已经通过 "],["onChange",[["c"]]],[" 这个事件把输入框的内容获取到了 "],["searchText",[["c"]]],[" 这个变量，因为我想做到的效果是响应式地对输入框的改变进行搜索，也就是你一边输入，一边结果就跟着出来，而不需要你输入回车后才能有相应，所以实际上就是一个依赖于 "],["searchText",[["c"]]],[" 的 "],["useEffect",[["c"]]],[" 。总结而言，我们对输入框的需求如下："]]},"created_time":1718257901861,"last_edited_time":1718260940125,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"f327fced-dfbb-44ad-b076-8e17488179d8":{"value":{"id":"f327fced-dfbb-44ad-b076-8e17488179d8","version":111,"type":"numbered_list","properties":{"title":[["针对输入内容响应式的发送请求；"]]},"created_time":1718260940268,"last_edited_time":1718260948794,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"cc1309f1-1982-486d-9656-daedd6ac0b63":{"value":{"id":"cc1309f1-1982-486d-9656-daedd6ac0b63","version":61,"type":"numbered_list","properties":{"title":[["按回车后立刻发送请求"]]},"created_time":1718260948931,"last_edited_time":1718260955759,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"2a068c53-99f5-4abf-b0aa-5e1aa6c80ddf":{"value":{"id":"2a068c53-99f5-4abf-b0aa-5e1aa6c80ddf","version":4,"type":"text","properties":{"title":[["有了这样的思路，我们很容易写出这样的代码："]]},"created_time":1718260924816,"last_edited_time":1718260924816,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"514bf167-c858-4930-8be6-07fb7a1cb474":{"value":{"id":"514bf167-c858-4930-8be6-07fb7a1cb474","version":216,"type":"code","properties":{"title":[["useEffect(() =\u003e {\n    if (searchText.trim()) {\n    // 搜索文本不为空，进行搜索\n      fetchSearchPosts()\n    } else {\n    // 搜索文本为空，重新获取所有数据\n      fetchPosts()\n    }\n  }, [searchText])"]],"language":[["JavaScript"]]},"created_time":1718259552065,"last_edited_time":1718259634218,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"8e489a9c-e1b4-4344-b570-796fc0caa8b9":{"value":{"id":"8e489a9c-e1b4-4344-b570-796fc0caa8b9","version":711,"type":"text","properties":{"title":[["但是我们不需要进行任何测试就可以轻易得出一个结论：这个体验并不好。因为我们响应式地针对"],["searchText",[["c"]]],[" 的每一次改变都发送了查询请求，这并不合理，当我输入 Apple 时，你应该等我输入完成再发送请求，而不是每当我输入一个字母就发送一次请求。"]]},"created_time":1718259437850,"last_edited_time":1718259742517,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"1a09b07d-3fb1-41a5-8fa2-9d7ef8ba378b":{"value":{"id":"1a09b07d-3fb1-41a5-8fa2-9d7ef8ba378b","version":339,"type":"text","properties":{"title":[["因此我们实际上需要等你完成输入之后等个 1s 钟，确认你没有输入了，再发送请求，这个功能有一个学名——"],["防抖",[["b"]]],["。"]]},"created_time":1718259742922,"last_edited_time":1718260198890,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"3fe2cc94-d08d-42b2-81cb-74b6f1c3c687":{"value":{"id":"3fe2cc94-d08d-42b2-81cb-74b6f1c3c687","version":42,"type":"toggle","properties":{"title":[["关于防抖"]]},"content":["79a047ab-d19f-4867-8155-cb5456dae6e7"],"created_time":1718260208927,"last_edited_time":1718260216738,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"e5559266-ebc1-428b-9bd2-26877799669b":{"value":{"id":"e5559266-ebc1-428b-9bd2-26877799669b","version":338,"type":"text","properties":{"title":[["那么我们该如何进行防抖处理呢，我们可以想到这样的方式："]]},"created_time":1718259696110,"last_edited_time":1718260606128,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"8991bef8-3f17-4cd4-8da3-55749a45df9d":{"value":{"id":"8991bef8-3f17-4cd4-8da3-55749a45df9d","version":139,"type":"numbered_list","properties":{"title":[["每次输入触发一个定时器，1s 后触发发送请求；"]]},"created_time":1718260472991,"last_edited_time":1718260493795,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"c7e908bd-3b63-47b9-a755-4d4a06e0d786":{"value":{"id":"c7e908bd-3b63-47b9-a755-4d4a06e0d786","version":132,"type":"numbered_list","properties":{"title":[["在触发请求之前清空上一次的定时器，避免重复触发。"]]},"created_time":1718260493970,"last_edited_time":1718260704207,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"da09f49f-5e29-442f-9f00-0245d77583e7":{"value":{"id":"da09f49f-5e29-442f-9f00-0245d77583e7","version":426,"type":"text","properties":{"title":[["对于如何清除上一次的定时器，我们可以在"],["useEffect",[["c"]]],[" 中的第一个参数传入的回调函数中返回一个用于清空定时器的函数，这个回调函数会在以下情况调用："]]},"created_time":1718260704377,"last_edited_time":1718260807473,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"86a8f63e-958e-4e9c-89fe-ce1403010856":{"value":{"id":"86a8f63e-958e-4e9c-89fe-ce1403010856","version":51,"type":"numbered_list","properties":{"title":[["依赖项变化时；"]]},"created_time":1718260807661,"last_edited_time":1718260815925,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"84cdf4e7-79a6-488c-a5ed-c108f803585b":{"value":{"id":"84cdf4e7-79a6-488c-a5ed-c108f803585b","version":40,"type":"numbered_list","properties":{"title":[["组件卸载时。"]]},"created_time":1718260816095,"last_edited_time":1718260821740,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"db10a8ec-541f-41d5-b61a-c6dc1b77b455":{"value":{"id":"db10a8ec-541f-41d5-b61a-c6dc1b77b455","version":964,"type":"text","properties":{"title":[["所以实际上我们只需要把清空定时器的函数返回就行了，不需要特意记录定时器的清空器；但还记得吗，我们还需要在用户输入回车后立即进行发送请求，所以实际上我们还是要记录最新的定时器钩子，方便我们在"],["onSubmit",[["c"]]],[" 事件上清除最新的定时器，并立即发送请求，所以具体的实现代码如下："]]},"created_time":1718260823446,"last_edited_time":1718261665364,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"670a2e9a-0efb-4a2c-a55b-462831b6c4a3":{"value":{"id":"670a2e9a-0efb-4a2c-a55b-462831b6c4a3","version":42,"type":"code","properties":{"title":[["// 处理防抖，同时记录最新的 timeoutId，便于清除\nconst [timeoutId, setTimeoutId] = useState(null)\nconst fetchSearchPosts = async () =\u003e {\n  const response = await fetch('/api/prompt/search?searchText=' + searchText)\n  const data = await response.json()\n  setPosts(data)\n}\nuseEffect(() =\u003e {\n  if (searchText.trim()) {\n    const newTimeout = setTimeout(() =\u003e {\n      fetchSearchPosts()\n    }, 1000)\n\n    setTimeoutId(newTimeout)\n    // 返回一个清除 timeout 的函数，会在下次 useEffect 调用/组件卸载时执行（so sweet）\n    return () =\u003e clearTimeout(newTimeout)\n  } else {\n    fetchPosts()\n    return () =\u003e clearTimeout(timeoutId)\n  }\n}, [searchText])\n\nconst handleSubmit = e =\u003e {\n  e.preventDefault()\n  clearTimeout(timeoutId)\n  fetchSearchPosts()\n}"]],"language":[["JavaScript"]]},"created_time":1718261666411,"last_edited_time":1718261746972,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"788943d2-00ff-468e-b771-ba55f8526a3c":{"value":{"id":"788943d2-00ff-468e-b771-ba55f8526a3c","version":64,"type":"sub_sub_header","properties":{"title":[["搜索 api 实现"]]},"created_time":1718261748704,"last_edited_time":1718262351226,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"38ef6535-c4dc-4543-a258-efb6008ca51c":{"value":{"id":"38ef6535-c4dc-4543-a258-efb6008ca51c","version":251,"type":"text","properties":{"title":[["在实现了搜索框的响应式输入查询、防抖后，我们需要具体实现查询的功能，我们的需求如下："]]},"created_time":1718262352859,"last_edited_time":1718262389723,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"52acee06-9a31-4699-9130-a17f851a7b75":{"value":{"id":"52acee06-9a31-4699-9130-a17f851a7b75","version":69,"type":"numbered_list","properties":{"title":[["基于 username 进行查询"]]},"created_time":1718262389921,"last_edited_time":1718262397786,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"b9aeaf83-1345-40eb-93f4-8d7837436a82":{"value":{"id":"b9aeaf83-1345-40eb-93f4-8d7837436a82","version":44,"type":"numbered_list","properties":{"title":[["基于 tag 进行查询"]]},"created_time":1718262397978,"last_edited_time":1718262400429,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"506a19d1-e7dd-4a9b-93e2-85ace381d1e0":{"value":{"id":"506a19d1-e7dd-4a9b-93e2-85ace381d1e0","version":69,"type":"numbered_list","properties":{"title":[["基于 prompt 的正文进行查询"]]},"created_time":1718262400665,"last_edited_time":1718262404941,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"b51ea575-5d08-4dab-b8fc-e03a813ed18e":{"value":{"id":"b51ea575-5d08-4dab-b8fc-e03a813ed18e","version":48,"type":"text","properties":{"title":[["数据库表设计如下："]]},"created_time":1718262807443,"last_edited_time":1718262814423,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"907c89fc-3098-4629-8cb7-9942d90b0bcc":{"value":{"id":"907c89fc-3098-4629-8cb7-9942d90b0bcc","version":50,"type":"code","properties":{"title":[["// Prompt\nimport { Schema, model, models } from 'mongoose'\n\nconst PromptSchema = new Schema({\n  creator: {\n    type: Schema.Types.ObjectId,\n    ref: 'User'\n  },\n  prompt: {\n    type: String,\n    required: [true, 'Prompt is required']\n  },\n  tag: {\n    type: String,\n    required: [true, 'Tag is required']\n  }\n})\n\nconst Prompt = models.Prompt || model('Prompt', PromptSchema)\nexport default Prompt\n"]],"language":[["JavaScript"]]},"created_time":1718262814563,"last_edited_time":1718262852151,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"8d1fdbcd-e118-44ad-a983-48fa9500bafa":{"value":{"id":"8d1fdbcd-e118-44ad-a983-48fa9500bafa","version":40,"type":"code","properties":{"title":[["// User\nimport { Schema, model, models } from 'mongoose'\n\nconst UserSchema = new Schema({\n  email: {\n    type: String,\n    unique: [true, 'Email already exists'],\n    required: [true, 'Email is required']\n  },\n  username: {\n    type: String,\n    required: [true, 'Username is required'],\n    match: [\n      /^(?=.{8,20}$)(?![_.])(?!.*[_.]{2})[a-zA-Z0-9._]+(?\u003c![_.])$/,\n      'Username invalid, it should contain 8-20 alphanumeric letters and be unique!'\n    ]\n  },\n  image: {\n    type: String\n  }\n})\n\nconst User = models.User || model('User', UserSchema)\n\nexport default User\n"]],"language":[["JavaScript"]]},"created_time":1718262831414,"last_edited_time":1718262857036,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"b0e4a4bf-afa8-49ed-b7b7-550b3debba8d":{"value":{"id":"b0e4a4bf-afa8-49ed-b7b7-550b3debba8d","version":265,"type":"text","properties":{"title":[["其实后两个都比较简单，主要是基于 username 的查询涉及关联查询，我的实现方式如下："]]},"created_time":1718262405226,"last_edited_time":1718262877791,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"1c5eb60f-6450-4ed7-be30-c2ddbddd9680":{"value":{"id":"1c5eb60f-6450-4ed7-be30-c2ddbddd9680","version":201,"type":"numbered_list","properties":{"title":[["首先在 User 表中搜索符合条件的 username 对应的 id；"]]},"created_time":1718262752712,"last_edited_time":1718262909378,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"bc5aaa6a-3a12-4d2c-afa5-cacc76571a29":{"value":{"id":"bc5aaa6a-3a12-4d2c-afa5-cacc76571a29","version":352,"type":"numbered_list","properties":{"title":[["然后在 Prompt 表中使用 or 条件（或者 and 条件，看你想做什么，我这里为了搜索出来结果多一点就用 or 了）加上 id 的判断"]]},"created_time":1718262909529,"last_edited_time":1718262952973,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"fe3cf6f7-d5e4-4907-bc09-726a440b4b2d":{"value":{"id":"fe3cf6f7-d5e4-4907-bc09-726a440b4b2d","version":40,"type":"text","properties":{"title":[["具体实现如下："]]},"created_time":1718262957614,"last_edited_time":1718262961055,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"d49d3745-c0db-46d6-8155-31481ace0592":{"value":{"id":"d49d3745-c0db-46d6-8155-31481ace0592","version":606,"type":"code","properties":{"title":[["import Prompt from '@/models/prompt'\nimport User from '@/models/user'\nimport { connectToDB } from '@/utils/database'\n\nexport const GET = async request =\u003e {\n  const { searchParams } = new URL(request.url)\n  const searchText = searchParams.get('searchText')\n\n  try {\n    await connectToDB()\n    // 拆分关键词\n    const keywordArray = searchText.split(' ').filter(kw =\u003e kw.trim() !== '')\n\n    // 构建关键词表达式组\n    const regexArray = keywordArray.map(kw =\u003e new RegExp(kw, 'i'))\n\n    // 查询所有满足条件的用户\n    const userConditions = regexArray.map(kw =\u003e ({ username: { $regex: kw } }))\n    const users = await User.find({ $or: userConditions })\n    const userIds = users.map(user =\u003e user._id)\n\n    // 查询满足条件的prompts\n    const prompts = await Prompt.find({\n    // 用空格区分的关键词更合理的方式是用 and，但我这里先用 or 了，看起来显得多一点\n      $or: [\n        { prompt: { $in: regexArray } },\n        { tag: { $in: regexArray } },\n        { creator: { $in: userIds } }\n      ]\n    }).populate('creator') // populate 方法，自动关联 User 表，但是前提需要在表设计时使用\n    // ref 指向你要关联的表\n\n    return new Response(JSON.stringify(prompts), { status: 200 })\n  } catch (error) {\n    return new Response('Failed to fetch prompts', { status: 500 })\n  }\n}"]],"language":[["JavaScript"]]},"created_time":1718262961237,"last_edited_time":1718263212032,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"0b7363c0-cf54-4d1c-9b6d-25c4429fa929":{"value":{"id":"0b7363c0-cf54-4d1c-9b6d-25c4429fa929","version":83,"type":"text","properties":{"title":[["这样我们就实现了搜索功能。"]]},"created_time":1718264198595,"last_edited_time":1718264875825,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"6fcc565a-d883-4606-8536-1c28a6c81c21":{"value":{"id":"6fcc565a-d883-4606-8536-1c28a6c81c21","version":89,"type":"sub_header","properties":{"title":[["后谈——优雅的封装"]]},"created_time":1718265364500,"last_edited_time":1718265386242,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"1a87d9a1-061c-4524-a8fe-635f5bae4188":{"value":{"id":"1a87d9a1-061c-4524-a8fe-635f5bae4188","version":1504,"type":"text","properties":{"title":[["我自诩为有代码洁癖（当然了，由于水平有限可能写出来的代码在别人看来也是💩，但至少我自己还要看的过去），之前实现的防抖逻辑全部都放在的 Feed 组件里，这并不优雅，Feed 组件应该只需要考虑这个组件内部的逻辑，但搜索这个功能其实跟 Feed 信息流没什么关系，只是这里有一个搜索框，而我们又需要调用搜索功能而已，所以我们不该把无关的功能全都堆在一个组件内部，这既不利于我们对搜索功能进行复用，也不利于别人理解我们的代码。所以实际上我们需要对这个搜索功能进行封装"]]},"created_time":1718265373024,"last_edited_time":1718265574664,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"21acc1f9-56a8-41cd-8e3f-9f3fe564cc2c":{"value":{"id":"21acc1f9-56a8-41cd-8e3f-9f3fe564cc2c","version":373,"type":"text","properties":{"title":[["在前端开发中，这种用于处理与组件状态、生命周期相关的逻辑，我们一般称其为 Hook，并使用 "],["use",[["c"]]],[" 开头的函数对其进行封装，并组织在 src/hooks 这一文件夹中，所以我封装了以下 hook："]]},"created_time":1718264256771,"last_edited_time":1718265649186,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"070d6806-2edf-49e4-b8a2-f99aad2b0a74":{"value":{"id":"070d6806-2edf-49e4-b8a2-f99aad2b0a74","version":31,"type":"code","properties":{"title":[["import { useState, useEffect } from 'react'\n\nconst useSearchPosts = (initialSearchText = '') =\u003e {\n  const [searchText, setSearchText] = useState(initialSearchText)\n  const [posts, setPosts] = useState([])\n  const [timeoutId, setTimeoutId] = useState(null)\n\n  // 获取所有 prompt\n  const fetchPosts = async () =\u003e {\n    const response = await fetch('/api/prompt')\n    const data = await response.json()\n    setPosts(data)\n  }\n\n  // 根据搜索关键词获取 prompt\n  const fetchSearchPosts = async () =\u003e {\n    const response = await fetch('/api/prompt/search?searchText=' + searchText)\n    const data = await response.json()\n    setPosts(data)\n  }\n\n  useEffect(() =\u003e {\n    fetchPosts()\n  }, [])\n\n  // 防抖\n  useEffect(() =\u003e {\n    if (searchText.trim()) {\n      const newTimeout = setTimeout(() =\u003e {\n        fetchSearchPosts()\n      }, 1000)\n\n      setTimeoutId(newTimeout)\n      return () =\u003e clearTimeout(newTimeout)\n    } else {\n      fetchPosts()\n      return () =\u003e clearTimeout(timeoutId)\n    }\n  }, [searchText])\n\n  const handleSearchChange = e =\u003e {\n    setSearchText(e.target.value)\n  }\n\n  const handleSubmit = e =\u003e {\n    e.preventDefault()\n    clearTimeout(timeoutId)\n    fetchSearchPosts()\n  }\n\n  return {\n    searchText,\n    posts,\n    fetchPosts,\n    handleSearchChange,\n    handleSubmit\n  }\n}\n\nexport default useSearchPosts"]],"language":[["JavaScript"]]},"created_time":1718265649823,"last_edited_time":1718265664816,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"af9b181c-ad58-46ad-ba1e-3d0c2c8ed46a":{"value":{"id":"af9b181c-ad58-46ad-ba1e-3d0c2c8ed46a","version":138,"type":"text","properties":{"title":[["并在 Feed 组件内调用，使用方式如下："]]},"created_time":1718265665706,"last_edited_time":1718265682898,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"b4aad56a-32fc-4868-9b75-7d4777a974a6":{"value":{"id":"b4aad56a-32fc-4868-9b75-7d4777a974a6","version":19,"type":"code","properties":{"title":[["'use client'\n\nimport React, { useContext, useState, useEffect } from 'react'\nimport PromptCard from './PromptCard'\nimport basePathContext from '@/context/basePathContext'\nimport useSearchPosts from '@/hooks/useSearchPosts'\n\nconst PromptCardList = ({ data, handleTagClick }) =\u003e {\n  return (\n    \u003cdiv className=\"mt-16 prompt_layout\"\u003e\n      {data.map(post =\u003e (\n        \u003cPromptCard key={post.id} post={post} handleTagClick={handleTagClick} /\u003e\n      ))}\n    \u003c/div\u003e\n  )\n}\n\nconst Feed = ({ basePath }) =\u003e {\n  const { searchText, posts, fetchPosts, handleSearchChange, handleSubmit } =\n    useSearchPosts()\n\n  useEffect(() =\u003e {\n    fetchPosts()\n  }, [])\n\n  return (\n    \u003cbasePathContext.Provider value={basePath}\u003e\n      \u003csection className=\"feed\"\u003e\n        \u003cform className=\"relative w-full flex-center\" onSubmit={handleSubmit}\u003e\n          \u003cinput\n            type=\"text\"\n            placeholder=\"Search for a tag or username\"\n            value={searchText}\n            onChange={handleSearchChange}\n            required\n            className=\"search_input peer\"\n          /\u003e\n        \u003c/form\u003e\n\n        \u003cPromptCardList data={posts} handleTagClick={() =\u003e {}} /\u003e\n      \u003c/section\u003e\n    \u003c/basePathContext.Provider\u003e\n  )\n}\n\nexport default Feed"]],"language":[["JavaScript"]]},"created_time":1718265683033,"last_edited_time":1718265695120,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"2e4810ca-c5d9-4127-a379-440fb8dcc1a1":{"value":{"id":"2e4810ca-c5d9-4127-a379-440fb8dcc1a1","version":23,"type":"sub_header","properties":{"title":[["总结"]]},"created_time":1718265725790,"last_edited_time":1718265730720,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"16219506-83f7-45ef-be70-3e820c13ca71":{"value":{"id":"16219506-83f7-45ef-be70-3e820c13ca71","version":783,"type":"text","properties":{"title":[["跟着视频敲代码很简单，很多时候 youtuber 不解释他为什么这么写，你也不会去思考这个功能为什么要分这么多个文件？分这么多层？但一旦从头开始思考一个功能如何实现，需要思考的问题就很多了，比如我们实际上只是实现了一个非常简单的搜索功能，但本身涉及的有："]]},"created_time":1718265730917,"last_edited_time":1718265831515,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"26c635b0-b504-47d2-aed4-5512e320d4d6":{"value":{"id":"26c635b0-b504-47d2-aed4-5512e320d4d6","version":51,"type":"numbered_list","properties":{"title":[["防抖功能的实现"]]},"created_time":1718265831681,"last_edited_time":1718265836399,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"3997e5a6-4f49-4bf7-afa1-87c5ab21fccc":{"value":{"id":"3997e5a6-4f49-4bf7-afa1-87c5ab21fccc","version":41,"type":"numbered_list","properties":{"title":[["搜索 api 的实现"]]},"created_time":1718265836584,"last_edited_time":1718265839134,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"5e3fceaf-6f92-458f-b567-e2f735700f24":{"value":{"id":"5e3fceaf-6f92-458f-b567-e2f735700f24","version":84,"type":"numbered_list","properties":{"title":[["自定义 Hook 的封装与调用"]]},"created_time":1718265839344,"last_edited_time":1718265847635,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"88dc0491-2d37-4e47-a423-34e71d5948ec":{"value":{"id":"88dc0491-2d37-4e47-a423-34e71d5948ec","version":55,"type":"divider","created_time":1718265888421,"last_edited_time":1718265932426,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"9c7b0abb-9e79-44ad-9e6c-257412b48220":{"value":{"id":"9c7b0abb-9e79-44ad-9e6c-257412b48220","version":76,"type":"text","properties":{"title":[["Wish you have a good day! 😇"]]},"created_time":1718265932423,"last_edited_time":1718265944399,"parent_id":"d11cc5a5-b975-4a3a-9d78-739e3680b3fa","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"},"79a047ab-d19f-4867-8155-cb5456dae6e7":{"value":{"id":"79a047ab-d19f-4867-8155-cb5456dae6e7","version":965,"type":"text","properties":{"title":[["笔者在本科上嵌入式的时候在设计键盘驱动时提到过这个防抖，当时这个功能主要是因为键盘的按键在按下时，输入信号可能会出现（以开关为例）多次通断，如果不在驱动层面进行处理，就会出现“双击”甚至“三击”，对这个现象的处理方式也叫“防抖”，所以实际上"],["防抖就是对短时间内重复输入的过滤",[["b"]]],["。"]]},"created_time":1718260216738,"last_edited_time":1718260361672,"parent_id":"3fe2cc94-d08d-42b2-81cb-74b6f1c3c687","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"4e783237-cc83-440e-9604-bac369009c55","last_edited_by_table":"notion_user","last_edited_by_id":"4e783237-cc83-440e-9604-bac369009c55","space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"}},"collection":{"4126d965-c550-46af-bc34-c038f0103084":{"value":{"id":"4126d965-c550-46af-bc34-c038f0103084","version":7,"name":[["NOBELIUM Template"]],"schema":{"NX\\Q":{"name":"date","type":"date","description":""},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"b67fb051-ddd9-43b5-9fdf-7b7f97a2e056","color":"yellow","value":"Jekyll"},{"id":"2382b30f-9881-4a8b-ae7f-2d34979c4fb9","color":"pink","value":"Website"},{"id":"674b2636-c585-4057-8a6d-0d6ab9718f90","color":"blue","value":"Cooking"},{"id":"499d31ac-26f2-4fed-9ec4-17afe3c6d90d","color":"red","value":"Sociology"},{"id":"38611f8e-ab81-4a71-8d40-7bad1370b26a","color":"orange","value":"TEMP"},{"id":"1ad9233c-079a-44c7-98c3-24ed2faf1879","color":"purple","value":"Book"},{"id":"a3d8eb51-77ce-4e83-a9ae-68da9cee63fa","color":"default","value":"Design"},{"id":"87df7c95-06f0-477a-a530-14be415a1dcf","color":"gray","value":"React"},{"id":"76cb8fea-49e8-47c1-a982-b3a8a23d2278","color":"green","value":"Next.js"},{"id":"63e95905-41f5-4027-8bd4-330129476432","color":"brown","value":"TODO"},{"id":"6dbab06e-0532-484d-9c94-9be429b2abf8","color":"red","value":"Nobelium"},{"id":"a7dda041-f452-423c-b00f-dbe7402400ca","color":"pink","value":"JavaScript"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🎟️","format":{"copied_from_pointer":{"id":"47ddddc3-991e-4ade-a7a4-a99e37f4d3ff","table":"collection","spaceId":"b3580129-1025-4b78-9e73-0a6f39f464ab"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"0eb813c6-179c-43e0-8c12-27cc22341e33","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"47ddddc3-991e-4ade-a7a4-a99e37f4d3ff","migrated":true,"space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"}},"space":{},"collection_view":{"1df80a31-46e8-4fcd-b9a3-dde8ded944c9":{"value":{"id":"1df80a31-46e8-4fcd-b9a3-dde8ded944c9","version":11,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":416,"visible":true,"property":"title"},{"width":186,"visible":true,"property":"d]hq"},{"width":145,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":222,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"}],"table_frozen_column_index":-1},"parent_id":"0eb813c6-179c-43e0-8c12-27cc22341e33","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","6efcebe0-a779-4ec2-a1cb-f77acbb36bf6","c62e81a1-03a9-4b5c-9a55-4e56867de3e4","5514a197-e266-4487-a3ce-95ae17f26bdb","51f3b1a2-a3d5-468a-b552-70d7b0c1a9cb","baacb561-6a62-4343-9e6a-bc1bba469a9c","9ca0671d-b580-4105-825c-d8ef4c531d84","d11cc5a5-b975-4a3a-9d78-739e3680b3fa","98540d41-1879-4bea-9bdf-fa17af5cc06e","f24edd31-035d-4744-9275-118e8751f2f9","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","59520f7f-1fe9-4c70-b059-8655b93e85df","5692c8b3-efa6-4f19-ab2e-4574afc33f46","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","fd348e41-3e72-42d2-8425-be67e8586a28","3128120c-366d-4937-a28a-f18a446f249b","a1d00689-b6f7-418b-888e-0b47edc21286","090eeb36-6c03-462f-9ada-d544c584641f","e97e229c-7a7c-4ce6-81f7-2cf8700e22ab","926771d9-3aab-4640-8dec-b1202f54aa69","b9a5c48f-1b00-4ae9-94bc-f683d6b393ad","30602d25-a696-40ee-b0fa-c252403391cf","a5da67e2-2ac7-4c3a-8833-50d78f853f9b","cf2532d2-7c86-4027-ae70-a81784ff4769","c1e63240-b7fe-4e0e-b753-78a9210b7779","81581b92-d191-4010-8c4f-e2c0e0b4a4ee","69e2cb5f-2c4a-408a-95b5-9d03f8ccfab3","b5b9b1d9-377b-4053-b110-988a9ec54af7","9a223272-0900-4cc3-a503-2515824da515","7c88ce0f-c4be-4335-abfe-adaaa2c6c99e","79bf7035-9dfd-4193-b7d1-cd578a30ac85","a453aa9d-324d-448f-94f0-c8adb4692241","1030c439-2997-45a7-90ca-f2df5de62e3e","1235234b-cfee-4611-8a9b-c6b32b379585","710ff2f6-c05e-4403-b72a-512bb27ab51f","019d0c55-59ee-4247-90c8-5f9017c37ba5","d105e4c2-dfdb-4c58-b8f5-54e182894431","95585600-97d8-4d2c-bf0c-6b9164dbee54","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"01ff42de-5b53-40d7-a69e-999e3574e640"},"role":"reader"}},"notion_user":{},"collection_query":{},"signed_urls":{}},"emailHash":"568c024e516219d57a6ef037a7cc3d32"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"Promptopia-dev-note-search-implementation"},"buildId":"rKeQK-aFhfc5v06FzUaGU","assetPrefix":"/nobelium","runtimeConfig":{"basePath":"/nobelium","assetPrefix":"/nobelium/"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>