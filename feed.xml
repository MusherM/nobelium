<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Musher's Frontend Coding Blog</title>
        <link>/</link>
        <description>無限進步</description>
        <lastBuildDate>Wed, 29 May 2024 08:40:18 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-CN</language>
        <copyright>All rights reserved 2024, Musher</copyright>
        <item>
            <title><![CDATA[Next.js 踩坑记（1）——路径体操]]></title>
            <link>/sci-fi-title-generator</link>
            <guid>/sci-fi-title-generator</guid>
            <pubDate>Wed, 29 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[总结一下使用Nextjs部署github page时遇到的img标签的路径问题]]></description>
            <content:encoded><![CDATA[<main class="notion light-mode notion-page notion-block-c62e81a103a94b5c9a554e56867de3e4"><div class="notion-viewport"></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-0a4c3d88bc0f49768be9047295ce0b24" data-id="0a4c3d88bc0f49768be9047295ce0b24"><span><div id="0a4c3d88bc0f49768be9047295ce0b24" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0a4c3d88bc0f49768be9047295ce0b24" title="静态资源路径问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">静态资源路径问题</span></span></h2><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token comment">/** @type {import('next').NextConfig} */</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">"export"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">basePath</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token literal-property property">assetPrefix</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio/"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">unoptimized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">NEXT_PUBLIC_ASSET_PREFIX</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> nextConfig<span class="token punctuation">;</span></code></pre><div class="notion-text notion-block-df693aea004043f1876efd43f7bb5f49">部署项目的过程中出现的问题：对于public文件夹中的静态资源，可以直接通过<code class="notion-inline-code">/1.png</code>访问，但编译后的<code class="notion-inline-code">/1.png</code>，将直接指向根目录，在本地这是<code class="notion-inline-code">C://</code>，在github page这是<code class="notion-inline-code">musherm.github.io/</code>，但实际上的静态资源地址在<code class="notion-inline-code">musherm.github.io/Portofolio</code>，该如何正确指向该地址？</div><pre class="notion-code language-html"><code class="language-html">// icon='/b1.svg'
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{</span>
    <span class="token attr-name">(process.env.NEXT_PUBLIC_ASSET_PREFIX</span> <span class="token attr-name">||</span> <span class="token attr-name">"")</span> <span class="token attr-name">+</span> <span class="token attr-name">icon</span>
  <span class="token attr-name">}</span>
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{icon}</span>
  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-2<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre><div class="notion-text notion-block-9754a9a2b43c484a818722b5e50d3430">答案是使用<code class="notion-inline-code">process.env.NEXT_PUBLIC_ASSET_PREFIX</code>这个环境变量，在github action编译时，通过修改Build过程时的环境变量指定环境为production，使<code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code> 这个环境变量变为<code class="notion-inline-code">/Portofolio</code> ，从而指向正确的地址</div><pre class="notion-code language-yaml"><code class="language-yaml"><span class="token operator">-</span> name<span class="token operator">:</span> Build <span class="token keyword">with</span> Next<span class="token punctuation">.</span>js
  <span class="token literal-property property">run</span><span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps<span class="token punctuation">.</span>detect<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>manager<span class="token punctuation">.</span>outputs<span class="token punctuation">.</span>runner <span class="token punctuation">}</span><span class="token punctuation">}</span> next build
  <span class="token literal-property property">env</span><span class="token operator">:</span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> production
    <span class="token constant">NEXT_PUBLIC_ASSET_PREFIX</span><span class="token operator">:</span> <span class="token operator">/</span>Portofolio</code></pre><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-ce0a67933863424d936e4f059261f1eb" data-id="ce0a67933863424d936e4f059261f1eb"><span><div id="ce0a67933863424d936e4f059261f1eb" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ce0a67933863424d936e4f059261f1eb" title="一些环境体操"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">一些环境体操</span></span></h3><ol start="1" class="notion-list notion-list-numbered notion-block-785b2436b65549928d24ef99928d6c52"><li>为什么需要使用<code class="notion-inline-code">(process.env.NEXT_PUBLIC_ASSET_PREFIX || &quot;&quot;)</code> ，而不是在dev环境下将<code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code> 这个变量设为空？因为根据我的观察，只要你试图把一个环境变量设为空，他就会变成<code class="notion-inline-code">undefined</code> ，所以干脆就这么写了</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-d2cf59672be64c62aa3cdf7e2972de79"><li>这个basePath也是，他只会更改你的项目的基本地址，不会自动更改你的静态资源的路径，也就是说如果把basePath设为<code class="notion-inline-code">/Portofolio</code> ，你本地的开发环境地址就会从127.0.0.1:3000变成127.0.0.1:3000/Portofolio，</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-e26509f3ddbf4a72a1188d2b146a86ea"><li>assetPrefix也是同理，没什么卵用，听起来像是能给你的静态资源加个前缀，但是没用</li></ol><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-af7391a212934dca9ae2773e78436861" data-id="af7391a212934dca9ae2773e78436861"><span><div id="af7391a212934dca9ae2773e78436861" class="notion-header-anchor"></div><a class="notion-hash-link" href="#af7391a212934dca9ae2773e78436861" title="关于basePath和assetPrefix"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">关于basePath和assetPrefix</span></span></h3><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-9a45a74fdaaa493da8698f5aafcd836f" data-id="9a45a74fdaaa493da8698f5aafcd836f"><span><div id="9a45a74fdaaa493da8698f5aafcd836f" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9a45a74fdaaa493da8698f5aafcd836f" title="basePath"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">basePath</span></span></h4><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-741f507e062e4142a3e7757219c22cd0" href="https://nextjs.org/docs/app/api-reference/next-config-js/basePath"><div><div class="notion-bookmark-title">next.config.js Options: basePath</div><div class="notion-bookmark-description">Use `basePath` to deploy a Next.js application under a sub-path of a domain.</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: basePath" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/basePath</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20basePath" alt="next.config.js Options: basePath" loading="lazy"/></div></a></div><div class="notion-text notion-block-06a0763c80124f00aaafdb5f3fd83556">该选项用于在一个子路径下部署项目，他主要在两种场景下生效：</div><ol start="1" class="notion-list notion-list-numbered notion-block-651c03fc7c2d4fc4a28f2fd7ca957aa6"><li>Links：当使用<code class="notion-inline-code">next/link</code>和<code class="notion-inline-code">next/router</code> 时，会自动添加basePath，也就是说<code class="notion-inline-code">&lt;Link href=&quot;/about&quot;&gt;About Page&lt;/Link&gt;</code> 会输出<code class="notion-inline-code">&lt;a href=&quot;/docs/about&quot;&gt;About Page&lt;/a&gt;</code> （<code class="notion-inline-code">basePath=’/docs’</code>）</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-ab119fb430df420fb41a70c4a81a8653"><li>Image：当使用<code class="notion-inline-code">next/image</code> 时，需要手动添加basePath，就像我做的那样</li></ol><h4 class="notion-h notion-h3 notion-h-indent-2 notion-block-460d264b99a948c58302d4dc80d24ca3" data-id="460d264b99a948c58302d4dc80d24ca3"><span><div id="460d264b99a948c58302d4dc80d24ca3" class="notion-header-anchor"></div><a class="notion-hash-link" href="#460d264b99a948c58302d4dc80d24ca3" title="assetPrefix"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">assetPrefix</span></span></h4><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-4435f1e4fe294c81805b4150c3a69c09" href="https://nextjs.org/docs/app/api-reference/next-config-js/assetPrefix"><div><div class="notion-bookmark-title">next.config.js Options: assetPrefix</div><div class="notion-bookmark-description">Learn how to use the assetPrefix config option to configure your CDN.</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: assetPrefix" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/assetPrefix</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20assetPrefix" alt="next.config.js Options: assetPrefix" loading="lazy"/></div></a></div><div class="notion-text notion-block-65dc149178ad4d22b5aa71a0fc0b7283">该选项仅针对<code class="notion-inline-code">_next/static</code> 下的静态js css资源，不会影响public下的资源，当然，这个选项还是要设的，不然可能css和js也会因为指向根目录而找不到</div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-a0b6b14e17f24df4b8ff9b681fe04ece" data-id="a0b6b14e17f24df4b8ff9b681fe04ece"><span><div id="a0b6b14e17f24df4b8ff9b681fe04ece" class="notion-header-anchor"></div><a class="notion-hash-link" href="#a0b6b14e17f24df4b8ff9b681fe04ece" title="可能的另一种方式：自定义ImageLoader"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">可能的另一种方式：自定义ImageLoader</span></span></h3><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-1c7c643a565649f4a869bf3289b3616a" href="https://nextjs.org/docs/app/api-reference/next-config-js/images"><div><div class="notion-bookmark-title">next.config.js Options: images</div><div class="notion-bookmark-description">Custom configuration for the next/image loader</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: images" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/images</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20images" alt="next.config.js Options: images" loading="lazy"/></div></a></div><div class="notion-text notion-block-739c9da903e1405bb196d7b7c496321b">使用<code class="notion-inline-code">next/image</code>时，可以通过自定义imageloader的方式，使用一个函数来返回对应的路径，这个函数就可以对src进行路径拼接等处理，以避免出现<code class="notion-inline-code">(process.env.NEXT_PUBLIC_ASSET_PREFIX || &quot;&quot;) + icon</code> 这样不优雅的代码</div><div class="notion-blank notion-block-770e0fdd9fd94d36be070c71bfa7a1bd"> </div></main>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Looking for more good science fiction book titles]]></title>
            <link>/sci-fi-title-generator</link>
            <guid>/sci-fi-title-generator</guid>
            <pubDate>Fri, 04 Mar 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.]]></description>
            <content:encoded><![CDATA[<main class="notion light-mode notion-page notion-block-6efcebe0a7794ec2a1cbf77acbb36bf6"><div class="notion-viewport"></div><div class="notion-text notion-block-f77231bc73184206b34939cb88f2aa59">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,</div><div class="notion-text notion-block-c2c90ce930eb4814b1c4a8caa2ce0a1a">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,</div></main>]]></content:encoded>
        </item>
    </channel>
</rss>