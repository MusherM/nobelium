<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Musher's Frontend Coding Blog</title>
        <link>/</link>
        <description>無限進步</description>
        <lastBuildDate>Thu, 30 May 2024 03:05:04 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-CN</language>
        <copyright>All rights reserved 2024, Musher</copyright>
        <item>
            <title><![CDATA[Next.js 踩坑记（1）——路径体操]]></title>
            <link>/path-middle</link>
            <guid>/path-middle</guid>
            <pubDate>Wed, 29 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[如何愉快的将你的 Nextjs 项目部署上 Github Page？]]></description>
            <content:encoded><![CDATA[<main class="notion light-mode notion-page notion-block-c62e81a103a94b5c9a554e56867de3e4"><div class="notion-viewport"></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-18c8656e71814ba5a5d2afb80ddf0ad9" data-id="18c8656e71814ba5a5d2afb80ddf0ad9"><span><div id="18c8656e71814ba5a5d2afb80ddf0ad9" class="notion-header-anchor"></div><a class="notion-hash-link" href="#18c8656e71814ba5a5d2afb80ddf0ad9" title="引言"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">引言</span></span></h3><div class="notion-text notion-block-f7f890b707114b1f96c8227213b48736">前段时间入坑了 React 开发，学习了基本语法后就决定找个项目跟着写写，由于b站上相关的资源重复率实在是太高了，我实在不想再写一个苍穹外卖之类的东西，于是在 YouTube 上找到了该视频，该项目是一个作品集项目，我觉得作为我 React 的 startup 非常不错，而且这个网页的审美也很合我的品味。</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-5733c7e25c254785a351304cda8f2311" href="https://www.youtube.com/watch?v=FTH6Dn3AyIQ&amp;list=PL6QREj8te1P6wX9m5KnicnDVEucbOPsqR"><div><div class="notion-bookmark-title">Build and Deploy an Amazing Developer Portfolio with Next JS and Framer Motion</div><div class="notion-bookmark-description">Learn how to build and deploy a modern developer portfolio with animations using Next.js. Perfect for showcasing your web development skills!

⭐ Hostinger - https://hostinger.com/mastery10
Use the code JAVASCRIPTMASTERY to save up to 91% on all yearly hosting plans.

🌟 Sentry - https://bit.ly/4abT6PG

🎨 Portfolio Figma Design - https://resource.jsmastery.pro/minimal-portfolio
📘 Portfolio Best Practices Guide - https://resource.jsmastery.pro/portfolio-best-practices
🤖 Special Discord Forum - https://resource.jsmastery.pro/portfolio-discord

🌟 Become a top 1% Next.js 14 developer: https://jsmastery.pro/next14
🚀 Skyrocket your career in 4 months: https://jsmastery.pro/masterclass

📚 Materials/References:
GitHub Repository (give it a star ⭐): https://github.com/adrianhajdin/portfolio
README (assets &amp; code): https://github.com/adrianhajdin/portfolio/blob/main/README.md

💻 Join our Discord Community - https://discord.com/invite/n6EdbFJ
🐦 Follow us on Twitter: http://twitter.com/jsmasterypro
🖼️ Follow us on Instagram: http://instagram.com/javascriptmastery

💼 Business Inquiries: contact@jsmastery.pro

Time Stamps 👇
00:00:00 — Intro
00:05:40 — Project Setup
00:14:48 — Hero Section
00:40:30 — Bento Grid
01:23:18 — Recent Projects
01:43:40 — Sentry
01:52:56 — Testimonials
02:06:00 — Work Experience
02:14:18 — My Approach Section
02:26:24 — Footer
02:35:13 — Fixing Bugs
02:39:19 — Deployment</div><div class="notion-bookmark-link"><img src="https://www.youtube.com/s/desktop/11f8caf2/img/favicon_144x144.png" alt="Build and Deploy an Amazing Developer Portfolio with Next JS and Framer Motion" loading="lazy"/><div>https://www.youtube.com/watch?v=FTH6Dn3AyIQ&amp;list=PL6QREj8te1P6wX9m5KnicnDVEucbOPsqR</div></div></div><div class="notion-bookmark-image"><img src="https://i.ytimg.com/vi/FTH6Dn3AyIQ/maxresdefault.jpg" alt="Build and Deploy an Amazing Developer Portfolio with Next JS and Framer Motion" loading="lazy"/></div></a></div><div class="notion-text notion-block-93319b5a226345aeb6c54062ce2147af">本着 up 敲一行我就敲一行的学习精神，两个半小时的项目也不难敲，最后项目上线的时候该博主使用 Vercel 进行部署，本着能省一点是一点的原则，我决定使用 Github Page 功能进行部署，主要原因如下</div><ol start="1" class="notion-list notion-list-numbered notion-block-2366d56a504b459680452bee0b0456c9"><li>免费，真的良心</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-4ae0b04b71b04a08829413e05dc21754"><li>本来这东西就是静态的，没什么后端服务，我想着给他渲染成纯静态页面丢上去不就完了呗</li></ol><div class="notion-text notion-block-3d9bf1a82a2147679e4fd71f1ea135fd">于是，开搞！</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-d7339765d3d444cd98d4786f05653467" data-id="d7339765d3d444cd98d4786f05653467"><span><div id="d7339765d3d444cd98d4786f05653467" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d7339765d3d444cd98d4786f05653467" title="困境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">困境</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-22f184ac2f4b4398ba27bd7f2bbdb643"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F01ff42de-5b53-40d7-a69e-999e3574e640%2F6a314909-e6df-4fac-a08c-1d1b16dc7717%2FUntitled.png?table=block&amp;id=22f184ac-2f4b-4398-ba27-bd7f2bbdb643&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-0169015b827f40319b5af395469dc896">首先，我遇到了第一个问题，部署页面有两种方式，我到底该使用 Github Action 方式，还是 Deploy from a branch 方式？网上介绍的大多是第二种方式，这里笔者推荐使用第一种方式，我们可以看到这两种方式配置好之后的工作流是什么样的，孰优孰劣大家自有评判</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-b2eb601e7b3f4bca9920e67b7cdc0090" data-id="b2eb601e7b3f4bca9920e67b7cdc0090"><span><div id="b2eb601e7b3f4bca9920e67b7cdc0090" class="notion-header-anchor"></div><a class="notion-hash-link" href="#b2eb601e7b3f4bca9920e67b7cdc0090" title="Github Action 方式"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Github Action 方式</span></span></h4><div class="notion-text notion-block-aaa4cc1394a74546b77d33e855d17786">以 main 分支为当前分支为例，只需要将当前 commit push 上去→触发 Github Action，直接完成 page 更新。</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-b01de668c8de46239a4c3a6140d1fff7" data-id="b01de668c8de46239a4c3a6140d1fff7"><span><div id="b01de668c8de46239a4c3a6140d1fff7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#b01de668c8de46239a4c3a6140d1fff7" title="Deploy from a branch 方式"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Deploy from a branch 方式</span></span></h4><div class="notion-text notion-block-3ec443dfe6aa4f398ae5f212e053b98a">本地修改后，在本地进行编译→使用 gh-pages 将编译结果推送到 gh-pages 分支，完成更新，相比于前一种方式，除了修改代码，还需要手动编译，再推送，非常不优雅。</div><hr class="notion-hr notion-block-e32aef135d0e4b098a1803fcc6eec67f"/><div class="notion-text notion-block-ddc314df393344bfac8e3bf684f84430">关于如何使用 Github Action 方式进行部署，选中该方式之后，github 会弹一个工作流文件出来，检测到当前项目为 Nextjs 项目后会自动推荐 Nextjs 的工作流，我们可以暂时先用这个工作流，后面再进行修改。</div><div class="notion-text notion-block-4ca4c07c08e64474a7b15f1fa250c40b">此时按理来说，只要你没有使用什么在服务端不可用的生命周期钩子，你的代码会顺利在 Github 的服务器上完成编译，并成为该项目的 Page，但事情并没有这么简单。</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-0a4c3d88bc0f49768be9047295ce0b24" data-id="0a4c3d88bc0f49768be9047295ce0b24"><span><div id="0a4c3d88bc0f49768be9047295ce0b24" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0a4c3d88bc0f49768be9047295ce0b24" title="静态资源路径问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">静态资源路径问题</span></span></h3><div class="notion-text notion-block-adcd58349e494d868073d96f56fa86bb">当我第一次看到 Github Action 中的工作流中，编译成功的绿标出现后，我非常兴奋的打开了我的网页，它长这样：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-6a7be33806574d99848be2eb6d82291d"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F01ff42de-5b53-40d7-a69e-999e3574e640%2F9ca960f8-e2dd-496e-b01d-4dbddff831bf%2FUntitled.png?table=block&amp;id=6a7be338-0657-4d99-848b-e2eb6d82291d&amp;cache=v2" loading="lazy" alt="这是我直接打开本地编译的结果，仅作演示" decoding="async"/><figcaption class="notion-asset-caption">这是我直接打开本地编译的结果，仅作演示</figcaption></div></figure><div class="notion-text notion-block-6b477b4e2d1d40ae86086829efe6a2fc">坑爹呢这是 😵‍💫，此时打开开发者工具发现，除了当前页面的 html 外，不论是处于<code class="notion-inline-code">_next/static</code> 路径下的静态资源（主要是js和css），还是处于<code class="notion-inline-code">public</code> 路径下的静态资源（主要是图片），资源路径通通是错的，这个项目的路径应该是<code class="notion-inline-code">musherm.github.io/Portofolio/</code> ，但所有的资源都指向<code class="notion-inline-code">musherm.github.io/</code> ，换言之，我需要给所有的静态资源路径前面加上一个<code class="notion-inline-code">’Portofolio/’</code> ，查阅官方文档，我们可以发现，nextjs.config.mjs这一文件中，存在两个选项与路径有关，他们分别是：</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-ce1110b89e114b1c8802daa02e4d3045" data-id="ce1110b89e114b1c8802daa02e4d3045"><span><div id="ce1110b89e114b1c8802daa02e4d3045" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ce1110b89e114b1c8802daa02e4d3045" title="basePath"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">basePath</span></span></h4><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-741f507e062e4142a3e7757219c22cd0" href="https://nextjs.org/docs/app/api-reference/next-config-js/basePath"><div><div class="notion-bookmark-title">next.config.js Options: basePath</div><div class="notion-bookmark-description">Use `basePath` to deploy a Next.js application under a sub-path of a domain.</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: basePath" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/basePath</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20basePath" alt="next.config.js Options: basePath" loading="lazy"/></div></a></div><div class="notion-text notion-block-06a0763c80124f00aaafdb5f3fd83556">该选项用于在一个子路径下部署项目，他主要在两种场景下生效：</div><ol start="1" class="notion-list notion-list-numbered notion-block-651c03fc7c2d4fc4a28f2fd7ca957aa6"><li>Links：当使用<code class="notion-inline-code">next/link</code>和<code class="notion-inline-code">next/router</code> 时，会自动添加basePath，也就是说<code class="notion-inline-code">&lt;Link href=&quot;/about&quot;&gt;About Page&lt;/Link&gt;</code> 会输出<code class="notion-inline-code">&lt;a href=&quot;/docs/about&quot;&gt;About Page&lt;/a&gt;</code> （<code class="notion-inline-code">basePath=’/docs’</code>）</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-ab119fb430df420fb41a70c4a81a8653"><li>Image：当使用<code class="notion-inline-code">next/image</code> 时，需要手动添加basePath，说白了就是不管你引用图片用的是<code class="notion-inline-code">&lt;img&gt;</code>还是<code class="notion-inline-code">&lt;Image&gt;</code> ，你通通需要手动把这个路径写完整</li></ol><div class="notion-callout notion-gray_background_co notion-block-5f8e024486e245778d1a3b0bfd0b70a4"><span class="notion-page-icon" role="img" aria-label="💡">💡</span><div class="notion-callout-text">官方既然考虑到了图片资源会出现这个问题，为啥不能通过 basePath 自动给他加上呢，无语了。</div></div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-460d264b99a948c58302d4dc80d24ca3" data-id="460d264b99a948c58302d4dc80d24ca3"><span><div id="460d264b99a948c58302d4dc80d24ca3" class="notion-header-anchor"></div><a class="notion-hash-link" href="#460d264b99a948c58302d4dc80d24ca3" title="assetPrefix"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">assetPrefix</span></span></h4><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-4435f1e4fe294c81805b4150c3a69c09" href="https://nextjs.org/docs/app/api-reference/next-config-js/assetPrefix"><div><div class="notion-bookmark-title">next.config.js Options: assetPrefix</div><div class="notion-bookmark-description">Learn how to use the assetPrefix config option to configure your CDN.</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: assetPrefix" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/assetPrefix</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20assetPrefix" alt="next.config.js Options: assetPrefix" loading="lazy"/></div></a></div><div class="notion-text notion-block-65dc149178ad4d22b5aa71a0fc0b7283">该选项仅针对<code class="notion-inline-code">_next/static</code> 下的静态js css资源，不会影响public下的资源，看来这一选项可以帮助我们解决js和css找不到的问题！</div><div class="notion-text notion-block-d7587d67f8324da684ebb18c8af9bc4a">修改我们的<code class="notion-inline-code">nextconfig</code> 为这样：</div><pre class="notion-code language-yaml"><code class="language-yaml"><span class="token comment">/** @type {import('next').NextConfig} */</span>
<span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">"export"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">"/Portofolio"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">assetPrefix</span><span class="token operator">:</span> <span class="token string">"/Portofolio/"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">unoptimized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> nextConfig<span class="token punctuation">;</span></code></pre><div class="notion-text notion-block-05b26bcf294643e39ce2b8313b0c0e0d">好，至少我们的js和css确实找到了，但是事情还没有解决，我们的img标签下的所有图片，无一例外，还是指向了根目录，根据官方文档，你必须手动给他加上。</div><div class="notion-text notion-block-9fe079cfbd4745a7b3269ab6982ba956">比如一个<code class="notion-inline-code">img</code>标签，你修改之前它长这样：</div><pre class="notion-code language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{icon}</span>
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{icon}</span>
  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-2<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre><div class="notion-text notion-block-51953bc8b96c4cc6ad34f03f8895f548">修改之后呢，它应该长这样：</div><pre class="notion-code language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{</span>
    <span class="token attr-name">process.env.NEXT_PUBLIC_ASSET_PREFIX</span> <span class="token attr-name">+</span> <span class="token attr-name">icon</span>
  <span class="token attr-name">}</span>
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{icon}</span>
  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-2<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre><div class="notion-text notion-block-6f600606692541a188b2cf4a083d5120">同时修改你的<code class="notion-inline-code">nextconfig</code>，提供一下<code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code> 这个环境变量，当然，你也可以通过.env .env.local 来提供，但我不喜欢把配置文件分散在好几个文件上，尽量集中管理比较清晰：</div><pre class="notion-code language-yaml"><code class="language-yaml"><span class="token comment">/** @type {import('next').NextConfig} */</span>
<span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">"export"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">"/Portofolio"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">assetPrefix</span><span class="token operator">:</span> <span class="token string">"/Portofolio/"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">unoptimized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">NEXT_PUBLIC_ASSET_PREFIX</span><span class="token operator">:</span> <span class="token string">"/Portofolio"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> nextConfig<span class="token punctuation">;</span></code></pre><div class="notion-text notion-block-9a461ca4e93745a3a0f3464f0bf8c2f1">到这里，你在编译的代码如果直接打开，资源路径应该已经加上了你的相对路径名，如果直接 push 上去，Github Action 部署还是会不成功，因为服务器端并不会读取你在 nextconfig 里定义的环境变量，你还需要在工作流中提供这个环境变量，所幸这个操作其实也很简单：打开用于定义工作流的文件，在我的环境下是.github/workflows/nextjs.yml，并在编译的时候提供环境变量，比如这样</div><pre class="notion-code language-html"><code class="language-html">- name: Build with Next.js
  run: ${{ steps.detect-package-manager.outputs.runner }} next build
  # Add this
  env:
    NEXT_PUBLIC_ASSET_PREFIX: /Portofolio</code></pre><div class="notion-text notion-block-61ae3e6125f04f0fb05ef8c16a96b7e8">添加的这一行，会在服务器端编译的过程中提供这个环境变量，从而保证编译后对于public文件夹下的静态资源访问正确，到这里，我们就已经完成了对于 Nextjs 项目的 Github Page 部署。</div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-1a092113c89c4e12b01d221610815496" data-id="1a092113c89c4e12b01d221610815496"><span><div id="1a092113c89c4e12b01d221610815496" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1a092113c89c4e12b01d221610815496" title="后谈"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">后谈</span></span></h3><div class="notion-text notion-block-f33dfea57e2342cb87801e27f2d0dcb1">细心的小伙伴可能发现，写死 <code class="notion-inline-code">basePath</code> <code class="notion-inline-code">assetPrefix</code> <code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code>这些变量，当你在本地dev环境开发时，你的首页会从<code class="notion-inline-code">localhost:3000</code>变成<code class="notion-inline-code">localhost:3000/Portofolio</code> ，如果你能接受，那其实也还行，但如果想“不行，我在本地开发的时候，我就要在<code class="notion-inline-code">localhost:3000</code>直接访问
！”那你可以继续看下去（没错，说的就是我自己，我真的忍受不了每次从终端点开这个链接，还需要手动补全后面的路径）。答案是，你可以像<code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code> 一样，再引入一个<code class="notion-inline-code">NODE_ENV</code> 来判断当前的开发环境，从而在生产环境使用子路径，但在开发环境不实用，此时<code class="notion-inline-code">nextconfig</code> 修改如下：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token comment">/** @type {import('next').NextConfig} */</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">"export"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">basePath</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token literal-property property">assetPrefix</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio/"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">unoptimized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">NEXT_PUBLIC_ASSET_PREFIX</span><span class="token operator">:</span> isProd <span class="token operator">?</span> <span class="token string">"/Portofolio"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> nextConfig<span class="token punctuation">;</span></code></pre><div class="notion-text notion-block-7d6e37c8d4e040048cdc942ffb521cc9">同时修改<code class="notion-inline-code">img</code>标签的<code class="notion-inline-code">src</code>如下</div><pre class="notion-code language-html"><code class="language-html">&lt;img 
	src={
    (process.env.NEXT_PUBLIC_ASSET_PREFIX || "") + "/profile.svg"
  }
  alt="profile"
/></code></pre><div class="notion-text notion-block-0c0eef999dc949c8b879afd744cfaa95">你可能想问为什么？按理来说我在dev环境已经指定了<code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code>为空啊？这就是<code class="notion-inline-code">Nextjs</code> 的又一大坑，<code class="notion-inline-code">Nextjs</code> 的环境变量无法指定为空！（至少据我所知）如果你像这样试图指定为空，它会变成<code class="notion-inline-code">undefined</code> ，因而你需要通过<code class="notion-inline-code">(process.env.NEXT_PUBLIC_ASSET_PREFIX || &quot;&quot;)</code> 这样的表达式体操来让<code class="notion-inline-code">undefined</code> 变成真正的空。</div><div class="notion-text notion-block-df693aea004043f1876efd43f7bb5f49">此外，你还需要修改 Github Action 的流程定义文件，从而指定编译环境为 <code class="notion-inline-code">production</code>。</div><pre class="notion-code language-yaml"><code class="language-yaml"><span class="token operator">-</span> name<span class="token operator">:</span> Build <span class="token keyword">with</span> Next<span class="token punctuation">.</span>js
  <span class="token literal-property property">run</span><span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps<span class="token punctuation">.</span>detect<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>manager<span class="token punctuation">.</span>outputs<span class="token punctuation">.</span>runner <span class="token punctuation">}</span><span class="token punctuation">}</span> next build
  <span class="token literal-property property">env</span><span class="token operator">:</span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> production
    <span class="token constant">NEXT_PUBLIC_ASSET_PREFIX</span><span class="token operator">:</span> <span class="token operator">/</span>Portofolio</code></pre><div class="notion-text notion-block-ce0a67933863424d936e4f059261f1eb">于是，经过这么一番折腾，我们终于调好了环境！</div><ol start="1" class="notion-list notion-list-numbered notion-block-aabd027e0bcb4ab39a1faca793487aa5"><li>在 Github Action 侧，我们通过 <code class="notion-inline-code">basePath</code> <code class="notion-inline-code">assetPrefix</code> <code class="notion-inline-code">NEXT_PUBLIC_ASSET_PREFIX</code> 三兄弟，完成了对<code class="notion-inline-code">css</code> <code class="notion-inline-code">js</code>  <code class="notion-inline-code">img</code> 这些静态资源的路径补全；</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-a4bf6e14b49a480d92faba672089c9a6"><li>在本地 dev 侧，我们将这三兄弟全部设为空，从而保持原有的根路径访问</li></ol><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-a0b6b14e17f24df4b8ff9b681fe04ece" data-id="a0b6b14e17f24df4b8ff9b681fe04ece"><span><div id="a0b6b14e17f24df4b8ff9b681fe04ece" class="notion-header-anchor"></div><a class="notion-hash-link" href="#a0b6b14e17f24df4b8ff9b681fe04ece" title="后后谈"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">后后谈</span></span></h3><div class="notion-text notion-block-72562cc3d9b04440bd5b33adfb9b699d">总结这篇博客查阅资料时，我查到了这个东西</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-1c7c643a565649f4a869bf3289b3616a" href="https://nextjs.org/docs/app/api-reference/next-config-js/images"><div><div class="notion-bookmark-title">next.config.js Options: images</div><div class="notion-bookmark-description">Custom configuration for the next/image loader</div><div class="notion-bookmark-link"><img src="https://nextjs.org/favicon.ico" alt="next.config.js Options: images" loading="lazy"/><div>https://nextjs.org/docs/app/api-reference/next-config-js/images</div></div></div><div class="notion-bookmark-image"><img src="https://nextjs.org/api/docs-og?title=next.config.js%20Options:%20images" alt="next.config.js Options: images" loading="lazy"/></div></a></div><div class="notion-text notion-block-739c9da903e1405bb196d7b7c496321b">由于你可以像这样定义<code class="notion-inline-code">image loader</code> ：</div><pre class="notion-code language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myImageLoader</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> src<span class="token punctuation">,</span> width<span class="token punctuation">,</span> quality <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://example.com/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?w=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>quality <span class="token operator">||</span> <span class="token number">75</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span></code></pre><div class="notion-text notion-block-770e0fdd9fd94d36be070c71bfa7a1bd">所以理论上，你也可以通过在imageLoader内部拼接src，从而补全路径，但笔者懒得写了，就先放到 todo List 吧。</div><hr class="notion-hr notion-block-1fb90465bc1342deb7aa7f9df1233aef"/><div class="notion-text notion-block-5d410fe2f59544d2a00921a7764075c4">成果展示：</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-585a070e8d5d440587103bd80405e37c" href="https://musherm.github.io/Portofolio/"><div><div class="notion-bookmark-title">Musher&#x27;s Portfolio</div><div class="notion-bookmark-description">Modern &amp; Minimalist JS Mastery Portfolio</div><div class="notion-bookmark-link"><div>https://musherm.github.io/Portofolio/</div></div></div></a></div><div class="notion-blank notion-block-fc39e43ba324400a86549d35cf2efd55"> </div></main>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Next.js 踩坑记（2）——开发依赖]]></title>
            <link>/dev-dependencies</link>
            <guid>/dev-dependencies</guid>
            <pubDate>Wed, 29 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Nextjs迷踪之——我只改了github action中的NODE_ENV=’production’，为什么编译就崩了？]]></description>
            <content:encoded><![CDATA[<main class="notion light-mode notion-page notion-block-5514a197e2664487a3ce95ae17f26bdb"><div class="notion-viewport"></div><div class="notion-text notion-block-2b746c5ea66d4c07a6bad92162b07e71">在写<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://musherm.github.io/Portofolio/">个人作品集</a>这个项目时，由于遇到了让人非常恼火的路径问题，于是有了这篇博客
</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-f48c6ae33f3649199a9380e905f002da" href="https://musherm.github.io/nobelium/path-middle"><div><div class="notion-bookmark-title">Next.js 踩坑记（1）——路径体操</div><div class="notion-bookmark-description">如何愉快的将你的 Nextjs 项目部署上 Github Page？</div><div class="notion-bookmark-link"><img src="https://musherm.github.io/apple-touch-icon.png" alt="Next.js 踩坑记（1）——路径体操" loading="lazy"/><div>https://musherm.github.io/nobelium/path-middle</div></div></div><div class="notion-bookmark-image"><img src="https://og-image-craigary.vercel.app/Next.js%20%E8%B8%A9%E5%9D%91%E8%AE%B0%EF%BC%881%EF%BC%89%E2%80%94%E2%80%94%E8%B7%AF%E5%BE%84%E4%BD%93%E6%93%8D.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg" alt="Next.js 踩坑记（1）——路径体操" loading="lazy"/></div></a></div><div class="notion-text notion-block-12e535aeba0948ed9b4ffae7ae1b356d">这篇博客是在 <a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://www.notion.so">notion</a> 上完成写作的（包括现在这篇），再加之我有过了解，有很多项目支持直接从 notion 构建自己的个人博客，作为一个前端开发者，怎么能没有自己的博客呢？于是开始选型，辗转之下找到了这篇文章：</div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-cad2a80668d44b40b9b55c2eadd6dcb4" href="https://emergencyexit.xyz/upgrade-blog"><div><div class="notion-bookmark-title">从 奇思乱想 到 妙想天开</div><div class="notion-bookmark-description">打怪→获得经验→升级⤴️</div><div class="notion-bookmark-link"><img src="https://emergencyexit.xyz/apple-touch-icon.png" alt="从 奇思乱想 到 妙想天开" loading="lazy"/><div>https://emergencyexit.xyz/upgrade-blog</div></div></div><div class="notion-bookmark-image"><img src="https://og-image-craigary.vercel.app/%E4%BB%8E%20%E5%A5%87%E6%80%9D%E4%B9%B1%E6%83%B3%20%E5%88%B0%20%E5%A6%99%E6%83%B3%E5%A4%A9%E5%BC%80.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg" alt="从 奇思乱想 到 妙想天开" loading="lazy"/></div></a></div><div class="notion-text notion-block-254f1eb665964205b2eee0fefdd17653">作者对各种从 notion 生成博客的项目进行了调研，最终选用了 nobelium 这一项目：</div><div></div><div class="notion-text notion-block-f436727745aa44e7978d157045523fff">好了，看来烦人的选型工作已经有人替我完成了，话不多说，开整！由于这个项目原型使用的是 Vercel 部署，但本着省钱的原则，作者和我都选择使用 Github Page 进行部署，这就要求我们将项目编译成静态页面，作者对此进行了一定的改造，所以本博客的部署实际上使用了作者改造的项目：</div><div></div><div class="notion-text notion-block-acb3272ff1da45a1a05ce806f95a880f">在根据教程进行了一番操作之后，我们又遇到了那个熟悉的问题：静态资源路径错误！</div><div class="notion-text notion-block-2bfea135c3b34fe8a7cc96a1a224e691">这是什么历史的循环？我因为出现静态资源路径错误，写了<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://musherm.github.io/nobelium/path-middle">一篇博客</a>专门介绍怎么解决这个问题，并且顺便部署一个博客把这篇文章放上去，但又在部署博客的过程中又遇到了静态资源报错。。。 😅</div><div class="notion-text notion-block-3a536b7571f843dda0ddb7d96c52d7af">但是没关系！很幸运，这又是一个 Nextjs 项目，而我又恰巧刚刚学会如何解决，这不是手拿把掐？开整！</div><div class="notion-text notion-block-d2aa64eff2b4431f8adcad209b53acdc">根据经验，我</div></main>]]></content:encoded>
        </item>
    </channel>
</rss>